function cajasMovibles(){$("div.box").not(".no-drop").draggable({revert:!0,zIndex:2e3,cursor:"crosshair",handle:".box-name",opacity:.8}).droppable({tolerance:"pointer",drop:function(e,o){{var r=o.draggable,t=$(this);r.position(),t.position()}r.swap(t),setTimeout(function(){var e=t.find("[id^=map-]"),o=r.find("[id^=map-]");o.length>0||e.length>0?(o.resize(),e.resize()):(r.resize(),t.resize())},50),setTimeout(function(){r.find("[id^=map-]").resize(),t.find("[id^=map-]").resize()},250)}})}function menuDescargaRecorrido(e){var o=$("#"+e).attr("alt");$("#recorridoHistorico-movil").empty(),$("#recorridoHistorico-movil").append("<div><h6>Recorrido del movil<div id='recorridoHistoricoMovil' alt='"+e+"' >"+o+"</div></div></h6>"),$("#dialogRecorridoHist").dialog("open")}function descargaRecorrido(){var e=$("#recorridoHistoricoFechaDesde").val(),o=$("#recorridoHistoricoFechaHasta").val(),r=$("#recorridoHistoricoMovil").attr("alt");return""==e?void alert("Debe seleccionar la fecha inicial"):""==o?void alert("Debe seleccionar la fecha final"):""==r?void alert("No se ha seleccionado un movil"):Date.parse(e)>Date.parse(o)?void alert("La fecha inicial no puede ser mayor que la fecha final"):void 0}function menuVisualizaRecorrido(e){var o=$("#"+e).attr("alt");$("#visualizaRecorridoHistorico-movil").empty(),$("#visualizaRecorridoHistorico-movil").append("<div><h6>Recorrido del movil<div id='visualizaRecorridoHistoricoMovil' title=\""+e+'" >'+o+"</div></div></h6>"),$("#dialogVisualizaRecorridoHist").dialog("open")}function verRecorrido(){var e=$("#visualizaRecorridoHistoricoFechaDesde").val(),o=$("#visualizaRecorridoHistoricoFechaHasta").val(),r=$("#visualizaRecorridoHistoricoMovil").attr("title");return""==e?void alert("Debe seleccionar la fecha inicial"):""==o?void alert("Debe seleccionar la fecha final"):""==r?void alert("No se ha seleccionado un movil"):Date.parse(e)>Date.parse(o)?void alert("La fecha inicial no puede ser mayor que la fecha final"):(datos={movil:r,desde:e,hasta:o},void $.ajax({url:"index.php?r=informes/recorrido",type:"POST",data:datos,context:document.body,success:function(e){return 0==e.length?void alert("No se encontraron registros en el rango de fechas seleccionado"):e.length>500?void alert("Se encontraron mas de 500 registros. Por favor acote su busqueda"):(limpiarMapa(),void visualizaRecorrido(e))}}).error(function(){console.log("Se produjo un error.\n")}))}function verificarCaidos(){$("#caidos-grid table tbody tr").remove(),$("#caidos-grid table tbody").append("<tr></tr>");var e=$("#minutosCaido").val();$.ajax({url:"index.php?r=operador/caidos&tiempo="+e,type:"POST",context:document.body,success:function(e){if(Object.keys(e).length<1)return void alert("No se encontraron moviles caidos.");for(var o=0;o<Object.keys(e).length;o++)$("#caidos-grid table tbody tr:last").after("<tr></tr>").append("<td>"+(o+1)+"</td><td>"+e[o].Clie_RazonSocial+"</td><td>"+e[o].Movil_Dominio+"</td><td>"+e[o].Reporte_IdDisp+"</td><td>"+e[o].EstadoMovil_Descripcion+"</td><td>"+e[o].Reporte_FechaServidor+"</td><td>"+e[o].Clie_Tel+"</td><td>"+e[o].Clie_Tel2+"</td><td>"+e[o].Clie_Email+"</td><td style='text-align: center;'><a onclick='prompt(\"Por favor ingrese su ticket\");' title='' data-toggle='tooltip' href='javascript:void()' data-original-title='Generar ticket'><i class='glyphicon glyphicon-flag'></i></a><a style='margin-left:8px;' onclick='alert(\"Correo enviado!\")' title='' data-toggle='tooltip' href='javascript:void()' data-original-title='Generar aviso por email al cliente'><i class='glyphicon glyphicon-envelope'></i></a></td>")}}).done(function(){$("[data-toggle=popover]").popover(),$("[data-toggle=tooltip]").tooltip()}).error(function(){console.log("Se produjo un error.\n")})}function verificarUltimasAlertas(e){$("#ultimas-alertas-grid table tbody tr").remove(),$("#ultimas-alertas-grid table tbody").append("<tr></tr>"),$("#tituloUltimasAlertas").empty(),$("#tituloUltimasAlertas").html("Ultimas alertas del movil "+e),$("body").addClass("cargando2"),$.ajax({url:"index.php?r=alertas/ultimas&dominioMovil="+e,type:"POST",context:document.body,success:function(e){if(Object.keys(e).length<1)return void alert("No se encontraron registros de alertas.");for(var o=0;o<Object.keys(e).length;o++)$("#ultimas-alertas-grid table tbody tr:last").after("<tr></tr>").append("<td>"+e[o].dominio+"</td><td>"+e[o].nombreMovil+"</td><td>"+e[o].fecha+"</td><td>"+e[o].ubicacion+"</td><td>"+e[o].tipo+"</td><td>"+e[o].descripcion+"</td><td id='"+e[o].idAlerta+"' style='text-align:center;'><a title='Marcar como leido' data-toggle='tooltip' href='javascript:void(0)' id='"+e[o].idAlerta+"' data-original-title='Marcar como leido' onclick='marcarAlertaLeida(this.id)'><i class='glyphicon glyphicon-check'></i></a></td>"),$("#modalUltimasAlertas").modal("show")}}).done(function(){$("body").removeClass("cargando2")}).error(function(){$("body").removeClass("cargando2"),console.log("Se produjo un error.\n")})}function marcarAlertaLeida(e){$.ajax({url:"index.php?r=alertas/marcarleida&id="+e,type:"POST",context:document.body,success:function(){$("td").children("#"+e).closest("tr").remove()}}).error(function(){console.log("Se produjo un error.\n")})}function buscarAlertas(){$.ajax({url:"index.php?r=alertas/verificarAlertas",type:"POST",context:document.body,success:function(e){""!=e&&mostrarAlerta(e)}}).error(function(){console.log("Se produjo un error.\n")})}function mostrarAlerta(e){var o="";$.notify(".",{position:"bottom right",clickToHide:!1,style:"metro",autoHide:!0,gap:50,autoHideDelay:5e4}),$("#contenido-alerta").empty();for(var r=0;r<Object.keys(e).length;r++)o="Dominio: "+e[r].Movil_Dominio+"<br>Movil: "+e[r].Movil_Nombre+"<br>Tipo: "+e[r].TiAl_descripcion+"<br>Fecha :"+e[r].AlerControl_FechaGPS+"<br>Velocidad: "+e[r].AlerControl_Velocidad+" km/h<br>Descripcion: "+e[r].AlerControl_TextoInforme+"<br>Ubicacion:"+e[r].Direccion+"<hr style='margin-top:10px;margin-bottom:10px;'>",$("#contenido-alerta").append(o)}function soloNumeros(e){var o=window.event?window.event.keyCode:e.which;return 8==o||46==o?!0:/\d/.test(String.fromCharCode(o))}var timerAlertaDeUsuario;$(document).ready(function(){cajasMovibles(),$.ajax({url:"index.php?r=alertas/verificarAlertas",type:"POST",context:document.body,success:function(e){""!=e&&mostrarAlerta(e)}}).error(function(e){console.log("Se produjo un error.\n"+e)}),timerAlertaDeUsuario=window.setInterval(buscarAlertas,8e4)}),jQuery.fn.swap=function(e){e=jQuery(e)[0];var o=this[0],r=o.parentNode.insertBefore(document.createTextNode(""),o);return e.parentNode.insertBefore(o,e),r.parentNode.insertBefore(e,r),r.parentNode.removeChild(r),this},$(document).on("click","#cerrar-alerta",function(){$(this).trigger("notify-hide")}),$(document).on("click","#detener-alerta",function(){window.clearInterval(timerAlertaDeUsuario),$("#detener-alerta").trigger("notify-hide")}),$.notify.addStyle("metro",{html:"<div style='width:280px;height:160px;padding:5px;z-index:10;font-size: 11px;'><div id='header-alerta' style='width:100%;height:35px;background:url(\"images/icono-alerta.png\");background-repeat: no-repeat;'><a href='index.php?r=alertas/ultimas'><h4 style='float:left;font-weight:bold;color:#583030;margin-left: 40px;'>ALERTA GENERADA</h4><a/><a class='close' id='cerrar-alerta' style='font-size:24px;'>&times;</a><a class='close' alt='Detener notificaciones en pantalla' id='detener-alerta' style='font-size:24px;'></a></div><div id='contenido-alerta' style='overflow-y:auto;width: 268px;height: 105px;'><span data-notify-text> </div></span></div>",classes:{error:{color:"#fafafa !important","background-color":"#F57F22",border:"1px solid #FF0000","-webkit-border-radius":"10px","-moz-border-radius":"10px","border-radius":"10px"}}});